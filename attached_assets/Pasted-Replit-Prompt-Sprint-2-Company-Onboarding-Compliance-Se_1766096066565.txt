Replit Prompt — Sprint 2: Company Onboarding + Compliance Setup (No Mock Data)

You are working inside an existing monorepo app with:

Frontend: Vite + React 18 + TypeScript + Tailwind + shadcn/ui + Wouter

Backend: Express (same port 5000)

DB: Postgres

ORM: Drizzle

Requirement: strict multi-tenancy and RBAC

Existing (from Sprint 0–1):

Console Manager auth + company creation

Support catalogue selection at company creation (company_service_selections)

Company user auth (company_token httpOnly cookie)

CompanyAdmin user management

Tenant guardrails + change_log is active

Sprint 2 Goal

Build the Company Onboarding Wizard that runs inside the provider tenant, so each company can configure their operational and compliance profile properly, without any fake data.

This onboarding must:

Trigger automatically when company setup is incomplete

Capture provider details and compliance scope

Confirm and adjust “Services Delivered” (the line items/support categories selected at creation)

Upload and index foundational documents (policies, org chart, insurance, incident processes, etc.)

Lock in “audit-ready settings” used later by templates/audits/reports

Write all changes to change_log

Hard rule: Do not add mock seed data, placeholder records, or demo content. Everything must be created by the user or Console Manager.

1) Database (Drizzle) — Add Company Setup Models
1.1 Update companies table

Add fields:

onboarding_status (enum: "not_started" | "in_progress" | "completed") default "not_started"

onboarding_completed_at (timestamp nullable)

1.2 New table: company_settings

Tenant-scoped settings used across the platform:

id (uuid pk)

company_id (uuid fk companies.id, unique)

trading_name (string nullable)

business_address (string nullable)

primary_phone (string nullable)

ndis_registration_groups (json array of strings nullable) // user-entered labels

operating_regions (json array of strings nullable) // e.g. suburbs/areas, user-entered

support_delivery_contexts (json array of strings nullable) // e.g. SIL, Community Access, Centre-Based, user-entered

key_risks_summary (text nullable) // short internal description

document_retention_note (text nullable) // optional

updated_at

created_at

1.3 New table: company_documents

Upload/index foundational evidence (do not store mock documents):

id (uuid pk)

company_id (uuid fk)

doc_type (enum:
"policy_pack",
"org_chart",
"incident_management_policy",
"medication_policy",
"behaviour_support_policy",
"restrictive_practice_policy",
"training_matrix",
"insurance",
"service_agreement_template",
"privacy_policy",
"complaints_policy",
"other"
)

title (string required)

storage_kind (enum: "upload" | "link")

file_path (string nullable) // if upload

file_name (string nullable)

file_mime (string nullable)

file_size (int nullable)

external_link (string nullable) // e.g. OneDrive link

notes (text nullable)

uploaded_by_company_user_id (uuid nullable fk company_users.id)

created_at

1.4 Update change_log usage

Ensure onboarding actions write:

COMPANY_ONBOARDING_STARTED

COMPANY_SETTINGS_UPDATED

COMPANY_DOCUMENT_ADDED

COMPANY_DOCUMENT_UPDATED

COMPANY_ONBOARDING_COMPLETED

COMPANY_SERVICES_UPDATED (if services delivered selection is changed)

2) Backend APIs (Express)

All endpoints must:

use requireCompanyAuth

derive companyId from token

never accept companyId from request body for tenant writes

write change_log for create/update actions

2.1 Onboarding status endpoints
GET /api/company/onboarding/status

Return:

onboarding_status

checklist booleans:

hasCompanySettings

hasAtLeastOneServiceSelected

hasAtLeastOneDocumentUploadedOrLinked

POST /api/company/onboarding/start

Sets onboarding_status to in_progress if not_started

Writes change_log COMPANY_ONBOARDING_STARTED

POST /api/company/onboarding/complete

Validates minimum requirements:

company_settings exists

company has at least 1 selected service in company_service_selections

company_documents count >= 1

If valid, set onboarding_status=completed and onboarding_completed_at timestamp

Writes change_log COMPANY_ONBOARDING_COMPLETED

2.2 Company settings endpoints
GET /api/company/settings

Returns company_settings (or null if not created)

PUT /api/company/settings

Upsert company_settings. Accept:

tradingName

businessAddress

primaryPhone

ndisRegistrationGroups (string[])

operatingRegions (string[])

supportDeliveryContexts (string[])

keyRisksSummary

documentRetentionNote

Validate with Zod. Keep fields optional but typed. Write change_log COMPANY_SETTINGS_UPDATED including before/after json.

2.3 Services delivered review/update

Company can review and adjust their selected services delivered (line items) during onboarding.
This must be CompanyAdmin-only.

GET /api/company/services

Return selected services grouped by category:

categories + selected line items

PUT /api/company/services

CompanyAdmin only. Accept either:

mode: "ALL" | "CATEGORY" | "CUSTOM"

selectedCategoryIds?: uuid[]

selectedLineItemIds?: uuid[]

Rules:

Same selection logic as Console create

Replace existing selections transactionally

Write change_log COMPANY_SERVICES_UPDATED with counts and mode

2.4 Document management
GET /api/company/documents

Return list of documents with metadata

POST /api/company/documents

Accept multipart upload OR link submission.
Support two modes:
A) Upload:

file uploaded to server storage (local folder is fine for now)

store file_path, file_name, file_mime, file_size
B) Link:

external_link required (e.g. OneDrive)

no file stored

Also accept:

docType

title

notes

Validate inputs. Write change_log COMPANY_DOCUMENT_ADDED.

PATCH /api/company/documents/:id

Update metadata:

title, notes, docType, external_link (if link)
Write change_log COMPANY_DOCUMENT_UPDATED.

Do not implement delete. Implement archive later. For now, allow update only.

3) File Upload Handling (Backend)

Implement a small upload handler:

store uploads in /uploads/company/{companyId}/

enforce max file size (e.g. 20MB)

allow common mime types (pdf, docx, xlsx, png, jpg)

sanitize filenames

return safe metadata

do not seed any files

4) Frontend (React + Wouter) — Onboarding Wizard

Create:

src/app/onboarding/

pages/OnboardingWizardPage.tsx

steps/Step1CompanyProfile.tsx

steps/Step2ServicesDelivered.tsx

steps/Step3Documents.tsx

steps/Step4ReviewSubmit.tsx

hooks/useOnboardingStatus.ts

Add route: /onboarding

Add guard logic:

If company onboarding_status != completed, redirect authenticated company users to /onboarding when they attempt to access /app

CompanyAdmin required for Step 2 (services update). Others can view selections read-only.

Wizard steps
Step 1: Company Profile

Form binds to PUT /api/company/settings

Fields:

trading name

address

phone

registration groups (multi-input chips, user-entered)

operating regions (multi-input chips)

support delivery contexts (multi-input chips)

key risks summary (short textarea)

No placeholders. Inputs start empty unless real values exist.

Step 2: Services Delivered

Show currently selected services grouped by category (from GET /api/company/services)

If CompanyAdmin: allow editing selection mode (ALL / CATEGORY / CUSTOM) using the same selection UI pattern from console creation:

select all

select by category

select individual

Submit to PUT /api/company/services

Step 3: Documents

Show list of current documents (GET /api/company/documents)

Add document:

choose doc type

title

notes

choose Upload OR OneDrive Link

Post to POST /api/company/documents

Display clearly that at least one document is required to complete onboarding

Step 4: Review and Complete

Show summary:

company profile fields

selected services count

documents count

Button “Complete onboarding”

calls POST /api/company/onboarding/complete

on success redirect to /app

UI styling:

Use shadcn/ui

Match the existing dark-accent theme

Clear validation messages (no generic “error occurred”)

5) RBAC and UX Rules

Only authenticated company users can access /onboarding

Only CompanyAdmin can edit services delivered

Auditor/Reviewer/StaffReadOnly can view services and documents

All changes log to change_log

6) Acceptance Criteria

Fresh system has zero mock data (only real data created through console/company flows)

On first company login, user is routed to /onboarding until completed

Onboarding completion is blocked unless:

settings saved

at least 1 service selected

at least 1 document uploaded or linked

Services selection changes are tenant-safe and transactional

Documents support upload and OneDrive link without placeholder data

change_log has entries for onboarding actions

Now implement everything above with strong typing, Zod validation, defensive error handling, and consistent UI.